## Updates to Splatter

### Performance of current simulations

```{r simulation-summary, fig.cap = "(ref:cap-sim-summary)", fig.scap = "(ref:scap-sim-summary)", out.width = "100%"}
sim_summary <- read_tsv(here("data/simulation-summary.tsv"),
                        col_types = cols(
                            .default = col_double(),
                            Dataset = col_character(),
                            Statistic = col_character()
                        ))

sim_summary <- sim_summary %>%
    mutate(Statistic = factor(
        Statistic,
        levels = rev(c("Mean", "Variance", "MeanVar", "LibSize", "ZerosCell",
                       "ZerosGene", "MeanZeros"))
    )) %>%
    mutate(Dataset = factor(
        Dataset,
        levels = c("Splat", "SplatDrop", "Simple", "BASiCS", "Lun", "Lun2",
                   "Lun2ZINB", "mfa", "PhenoPath", "scDD", "SparseDC",
                   "ZINBWaVE"),
        labels = c("Splat", "Splat (Drop)", "Simple", "BASiCS", "Lun", "Lun2",
                   "Lun2 (ZINB)", "mfa", "PhenoPath", "scDD", "SparseDC",
                   "ZINB-WaVE")
    )) %>%
    mutate(Rank = factor(MADRank))

p1 <- ggplot(sim_summary, aes(x = Dataset, y = Statistic, fill = Rank)) +
    geom_tile() +
    coord_equal() +
    scale_fill_viridis_d(direction = -1) +
    scale_y_discrete(labels = c("Mean"      = "Mean",
                                "Variance"  = "Variance",
                                "MeanVar"   = "Mean-Variance",
                                "LibSize"   = "Library Size",
                                "ZerosCell" = "% Zeros (Cell)",
                                "ZerosGene" = "% Zeros (Gene)",
                                "MeanZeros" = "Mean-Zeros")) +
    ggtitle("Rank of MAD from real data") +
    guides(fill = guide_legend(ncol = 1)) +
    theme_minimal() +
    theme(plot.title = element_text(size = 24, face = "bold", hjust = 0.4),
          axis.title = element_blank(),
          axis.text = element_text(size = 12),
          axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5),
          panel.grid = element_blank(),
          strip.text = element_text(size = 16, face = "bold"),
          legend.title = element_text(size = 14),
          legend.text = element_text(size = 12),
          legend.key.size = unit(25, "points"),
          legend.position = "right")

ggsave(here("figures/sim-summary.pdf"), p1, height = 6, width = 8)
ggsave(here("figures/sim-summary.png"), p1, height = 6, width = 8)

knitr::include_graphics(here::here("figures/sim-summary.png"))
```

(ref:scap-sim-summary) Performance of current Splatter simulations.

(ref:cap-sim-summary) Performance of current Splatter simulations. Synthetic datasets were produced using parameters estimated from 500 random cells from the Tung dataset. Plot shows the rank of median absolute deviation (MAD) from the real dataset on a variety of measures from least similar (blue) to most similar (yellow). The ZINB-WaVE model best reproduces this dataset followed by the updated BASiCS model. The Splat model also performs well despite having a less sophisticated estimation procedure.
