---
output: html_document
editor_options: 
  chunk_output_type: console
---
## Usage of the scRNA-tools website {#tools-usage}

Since it was launched in July 2017 the scRNA-tools website has been used by
people from around the world (Figure \@ref(fig:tools-analytics-plot)). Usage
has increased since release of the publication and the website now receives an
average of around 750 visitors per month (Figure
\@ref(fig:tools-analytics-plot)A). These users come from over
`r 10 * floor(n_countries / 10)` countries around the world (Figure
\@ref(fig:tools-analytics-plot)B) with the USA being by far the most common
location, followed by China, Australia, the United Kingdom and countries in
Western Europe (Figure \@ref(fig:tools-analytics-plot)C). Aggregating by
continent (Figure \@ref(fig:tools-analytics-plot)D) better reflects population
size and the size of academic communities, with the Americas responsible for
the majority of traffic followed by Europe and Asia.

```{r tools-analytics-plot, fig.cap = "(ref:cap-analytics)", fig.scap = "(ref:scap-analytics)", out.width = "100%"}
users <- tools_users %>%
    gather(key = Type, value = Users, -Date) %>%
    mutate(Type = factor(Type,
                         levels = c("Users1Day", "Users7Day", "Users30Day"),
                         labels = c("1 Day", "7 Days", "30 Days"))) %>%
    ggplot(aes(x = Date, y = Users, colour = Type)) +
    geom_vline(xintercept = as.Date("2017-11-01"), colour = pal["grey"]) +
    annotate("text", label = "Genome Informatics\npresentation",
             x = as.Date("2017-11-01"), y = Inf,
             angle = 90, hjust = 1, vjust = -0.5,
             size = 4, colour = pal["grey"]) +
    geom_vline(xintercept = as.Date("2018-03-23"), colour = pal["grey"]) +
    annotate("text", label = "bioRxiv preprint",
             x = as.Date("2018-03-23"), y = Inf,
             angle = 90, hjust = 1, vjust = -1,
             size = 4, colour = pal["grey"]) +
    geom_vline(xintercept = as.Date("2018-06-25"), colour = pal["grey"]) +
    annotate("text", label = "Publication",
             x = as.Date("2018-06-25"), y = Inf,
             angle = 90, hjust = 1, vjust = -1,
             size = 4, colour = pal["grey"]) +
    geom_line(size = 2) +
    scale_color_manual(values = unname(pal)) +
    scale_x_date(breaks = scales::pretty_breaks(n = 10),
                 date_labels = "%b %Y") +
    ggtitle("") +
    theme_minimal() +
    theme(axis.title.x = element_blank(),
          legend.title = element_blank())

world <- map_data("world")
plot_data <- left_join(world, tools_countries, by = c(region = "Country"))
map <- ggplot(plot_data, aes(x = long, y = lat, group = group, fill = Users)) +
    geom_polygon() +
    scale_fill_viridis_c(na.value = "grey80") +
    ggtitle("") +
    theme_minimal() +
    theme(axis.title = element_blank(),
          axis.text = element_blank(),
          panel.grid = element_blank(),
          legend.position = "bottom")

plot_data <- tools_countries %>%
    group_by(Country) %>%
    tally(Users, sort = TRUE) %>%
    mutate(Country = factor(c(Country[1:10], rep("Other", n() - 10)),
                            levels = c(Country[1:10], "Other"))) %>%
    group_by(Country) %>%
    tally(n) %>%
    rename(Users = nn) %>%
    mutate(Country = forcats::fct_rev(Country)) %>%
    mutate(Label = paste0(Country, " ",
                          chrRound(Users / sum(Users) * 100, 1), "%")) %>%
    mutate(TooLow = if_else((Users - 0.3 * max(Users)) < 0,
                             TRUE, FALSE)) %>%
    mutate(Colour = if_else(TooLow, "grey40", "white")) %>%
    mutate(hjust = if_else(TooLow, -0.1, 1.1))

countries <- ggplot(plot_data, aes(x = Country, y = Users, fill = Country)) +
    geom_col() +
    geom_text(aes(label = Label, colour = Colour, hjust = hjust),
                  size = 3.5) +
    scale_fill_manual(values = unname(c(pal["grey"],
                                        rep(pal["purple"], 10)))) +
    scale_colour_identity() +
    coord_flip() +
    ggtitle("") +
    theme_minimal() +
    theme(axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          panel.grid = element_blank(),
          legend.position = "none")

plot_data <- tools_countries %>%
    group_by(Continent) %>%
    summarise(Users = sum(Users)) %>%
    arrange(-Users) %>%
    mutate(Continent = factor(Continent, levels = Continent)) %>%
    mutate(Continent = forcats::fct_relevel(Continent,
                                            "(not set)", after = Inf),
           Continent = forcats::fct_recode(Continent,
                                           Unknown = "(not set)"),
           Continent = forcats::fct_rev(Continent)) %>%
    mutate(Label = paste0(Continent, " ",
                          chrRound(Users / sum(Users) * 100, 1), "%")) %>%
    mutate(TooLow = if_else((Users - 0.3 * max(Users)) < 0,
                             TRUE, FALSE)) %>%
    mutate(Colour = if_else(TooLow, "grey40", "white")) %>%
    mutate(hjust = if_else(TooLow, -0.1, 1.1))

continents <- ggplot(plot_data,
                     aes(x = Continent, y = Users, fill = Continent)) +
    geom_col() +
    geom_text(aes(label = Label, colour = Colour, hjust = hjust),
                  size = 4) +
    scale_fill_manual(values = unname(c(pal["grey"],
                                        rep(pal["purple"], 5)))) +
    scale_colour_identity() +
    coord_flip() +
    ggtitle("") +
    theme_minimal() +
    theme(axis.title.y = element_blank(),
          axis.text.y = element_blank(),
          panel.grid = element_blank(),
          legend.position = "none")

p1 <- plot_grid(map, countries, continents,
                nrow = 1, rel_widths = c(1, 0.7, 0.7), hjust = 0,
                labels = c("B - Users by country",
                           "C - Top 10 countries",
                           "D - Users by continent"))
panel <- plot_grid(users, p1,
                   ncol = 1, rel_heights = c(0.9, 1), hjust = 0,
                   labels = c("A - Users over time", ""))

ggsave(here("figures/02-analytics.pdf"), panel, height = 6, width = 8)
ggsave(here("figures/02-analytics.png"), panel, height = 6, width = 8)

knitr::include_graphics(here::here("figures/02-analytics.png"))
```

(ref:scap-analytics) Usage of the scRNA-tools website.

(ref:cap-analytics) Usage of the scRNA-tools website. (A) Usage over time showing the number of users per day (pink), week (blue) or 30 days (green). Labelled vertical lines indicate events that may have influenced traffic. (B) World map coloured according to number of users from low (blue) to high (yellow). (C) Number of users from the top 10 most common countries. (D) Number of users by continent.

Although these figures may not seem large when compared to an average website,
they represent a significant part of the scRNA-seq community. Seeing usage of
the website from so many countries sustained over this period of time suggests
that the database is a useful resource. I intend to continue maintain and grow
the resource by adding new tools and updating those in the database. I hope to
encourage contributions from the community who can easily submit changes via a
form on the website.
